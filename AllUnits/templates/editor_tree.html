<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Система управления навыками голосового помощника</title>

    <link rel="stylesheet" href="static/css/style-main.css">
    <link rel="stylesheet" href="static/css/style-tabs.css">

    <link rel="stylesheet" href="/static/CSS/tree_style.css">


    {% macro render_tree(scene) %}
        {% if scene.children != [] %}
            <li><div class="caret">
                <span class="caret_name">{{ scene.name }}</span>
                <div class="scene_adder" style="display: flex; justify-content: right;
                align-items: right; float: right;">+</div>
            </div>
                <ul class="nested">
            {% for child in scene.children %}
                {{ render_tree(child) }}
            {% endfor %}
                </ul>
            </li>
            {% else %}
            <li> <div class="empty_caret" style="border: 1px solid black;"><span class="caret_name">{{ scene.name }}</span>
            <br><div class="scene_adder" style="display: flex; justify-content: right;
                align-items: right; float: right;">+</div>
            </div>
            </li>
        {% endif %}
    {% endmacro %}
</head>
<body>
    {% include '__block_tabs.html' %}
    <div class = "super_flex">
    <div class = "tree_print" style="background-color:#F0F4EF;">
    <!--
    {% for scene in text_scenes %}
        <p> {{scene}} </p>
        {% endfor %}
    -->
        <ul id="treeUL">
        {{ render_tree(all_tree.root) }}
        </ul>
    </div>

    <!--
    <div class= "scene_print">
    <p> {{ all_scenes }} </p>
    <p> Сейчас в сцене - {{ scene_name }} </p>
    <p> Порядок: потомки, переходы, ответ, вопросы </p>
    {% for stat in scene_stats %}
        <p> {{stat}} </p>
    {% endfor %}
    </div>
    -->
    <div class = "scene_options" id= "scene_options">
    <form method="get">
        <input type="hidden" name = go_to_scene value="1">
        <input type="text" name = scene_name value="Имя сцены">
        <input type="submit" value="Перейти в сцену">
    </form>
    <br>
    <form method="get">
        <input type="hidden" name = add_child_scene value="1">
        <input type="text" name = child_scene_name> Имя сцены
        <input type="submit" value="Добавить потомка">
    </form>
    {% if child_scene_name != None %}
        <p> Успешно добавлена в потомки сцены {{ scene_name }} сцена {{ child_scene_name }}</p>
    {% endif %}

        <form method="get">
        <p> Данные сцены</p>
        <input type="hidden" name = add_scene value="1">
            <br><input type="text" name = parent_scene_name> Имя родительской сцены
        <br><input type="text" name = scene_name value="{{current_scene.name}}"> Имя сцены
        <br><input type="text" name = pass_conditions value="{{current_scene.pass_conditions}}"> Условия перехода
        <br><textarea name = answer rows="4" cols="50" value="{{current_scene.answer}}"> </textarea> Шаблон ответа
        <br><textarea name = questions rows="4" cols="50" value="{{current_scene.questions}}"> </textarea> Шаблоны вопроса
            <br><input type="text" name = available_intents value="{{current_scene.available_intents_list}}"> Интенты сцены
        <br>
        <br><input type="text" name = clarifying_question value="{{current_scene.clarifying_question}}"> Уточняющий вопрос
        <br><input type="submit" value="Добавить сцену">
    </form>

    </div>
    </div>
    <div class = "scene_options" id="scene_to_add" style="display:none;">
        <form method="get">
        <input type="hidden" name = go_to_scene value="1">
        <input type="text" name = scene_name value="Имя сцены">
        <input type="submit" value="Перейти в сцену">
    </form>
    <br>
    <form method="get">
        <input type="hidden" name = add_child_scene value="1">
        <input type="text" name = child_scene_name> Имя сцены
        <input type="submit" value="Добавить потомка">
    </form>
    {% if child_scene_name != None %}
        <p> Успешно добавлена в потомки сцены {{ scene_name }} сцена {{ child_scene_name }}</p>
    {% endif %}


        <form method="get">
        <p> Новая сцена</p>
        <input type="hidden" name = add_scene value="1">
        <br><input type="text" name = scene_name value="{{current_scene.name}}"> Имя сцены
        <br><input type="text" name = pass_conditions value="{{current_scene.pass_conditions}}"> Условия перехода
        <br><textarea name = answer rows="4" cols="50" value="{{current_scene.answer}}"> </textarea> Шаблон ответа
        <br><textarea name = questions rows="4" cols="50" value="{{current_scene.questions}}"> </textarea> Шаблоны вопроса
            <br><input type="text" name = available_intents value="{{current_scene.available_intents_list}}"> Интенты сцены
        <br>
        <br><input type="text" name = clarifying_question value="{{current_scene.clarifying_question}}"> Уточняющий вопрос
        <br><input type="submit" value="Добавить сцену">
    </form>
        <form method="get">
            <select>
                <optgroup label="graph_intents">
                    {% for graph_intent in graph_intents %}
                        <option value="{{graph_intent}}"> {{graph_intent}} </option>
                    {% endfor %}
                </optgroup>
            </select>
            <br><input type="submit" value="Добавить интент">
        </form>
    <form method="get">
        <p> Удаление сцены (и ее потомков)!!!</p>
        <input type="hidden" name = delete_scene value="1">
        <input type="hidden" name = hidden_scene_name value="1">
        <br><input type="submit" value="Удалить сцену">
    </form>
    </div>
    <form method="get">
        <input type="hidden" name = save_tree value="1">
        <br><input type="submit" value="Сохранить дерево">
    </form>

<script>
    var toggler = document.getElementsByClassName("caret");
    var i;
    for (i = 0; i < toggler.length; i++) {
        toggler[i].addEventListener("click", function() {
            this.parentElement.querySelector(".nested").classList.toggle("active");
            this.classList.toggle("caret-down");
            element_change = document.getElementById("scene_options");
            element_add = document.getElementById("scene_to_add");
            if (element_change.style.display == 'none') {
                element_add.style.display = 'none';
                element_change.style.display = 'flex';
            }
        });
    }

    var toggler2 = document.getElementsByClassName("scene_adder");
    var j;
    var element;
    for (j = 0; j < toggler2.length; j++) {
        toggler2[j].addEventListener("click", function() {
            element_change = document.getElementById("scene_options");
            element_add = document.getElementById("scene_to_add");
            if (element_add.style.display == 'none') {
                element_add.style.display = 'flex';
                element_change.style.display = 'none';
            }
            /* else {
                element_add.style.display = 'none';
                element_change.style.display = 'flex';
            } */
        });
    }

</script>

</body>
</html>